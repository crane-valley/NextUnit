<Project>
  <PropertyGroup Condition="'$(IsTestProject)' == 'true'">
    <OutputType>Exe</OutputType>
    <EnableMSTestRunner>true</EnableMSTestRunner>
  </PropertyGroup>

  <ItemGroup Condition="'$(IsTestProject)' == 'true'">
    <PackageReference Include="Microsoft.Testing.Platform.MSBuild" Version="2.0.2" />
  </ItemGroup>

  <!-- Generate NextUnit MSBuild extension hook for automatic framework registration -->
  <Target Name="GenerateNextUnitMSBuildHook" BeforeTargets="BeforeCompile;CoreCompile" Condition="'$(IsTestProject)' == 'true'">
    <PropertyGroup>
      <NextUnitMSBuildHookPath>$(IntermediateOutputPath)NextUnitMSBuildExtension.g.cs</NextUnitMSBuildHookPath>
      <NextUnitMSBuildHookContent>
//------------------------------------------------------------------------------
// &lt;auto-generated&gt;
//     This code was generated by NextUnit build targets
// &lt;/auto-generated&gt;
//------------------------------------------------------------------------------

using Microsoft.Testing.Platform.Builder%3B
using NextUnit.Platform%3B

namespace Microsoft.Testing.Platform.MSBuild%3B

internal static class NextUnitMSBuildExtension
{
    public static void AddExtensions(ITestApplicationBuilder builder, string[] args)
    {
        builder.AddNextUnit()%3B
    }
}
      </NextUnitMSBuildHookContent>
    </PropertyGroup>
    <WriteLinesToFile File="$(NextUnitMSBuildHookPath)" Lines="$(NextUnitMSBuildHookContent)" Overwrite="true" WriteOnlyWhenDifferent="true" />
    <ItemGroup>
      <Compile Include="$(NextUnitMSBuildHookPath)" />
      <FileWrites Include="$(NextUnitMSBuildHookPath)" />
    </ItemGroup>
  </Target>
</Project>
